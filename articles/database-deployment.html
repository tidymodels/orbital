<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Database deployment • orbital</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Database deployment">
<meta name="description" content="Deploy orbital predictions to a database by creating tables or views, with guidance on when to use each approach.">
<meta property="og:description" content="Deploy orbital predictions to a database by creating tables or views, with guidance on when to use each approach.">
<meta property="og:image" content="https://orbital.tidymodels.org/logo.png">
<script src="https://cdn.jsdelivr.net/gh/posit-dev/supported-by-posit/js/badge.min.js" data-max-height="43" data-light-bg="#666f76" data-light-fg="#f9f9f9"></script><script defer data-domain="orbital.tidymodels.org,all.tidymodels.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">orbital</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.5.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/orbital.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/supported-models.html">Supported Models and recipes steps</a></li>
    <li><a class="dropdown-item" href="../articles/pros-cons.html">Pros and Cons</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tidymodels/orbital/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Database deployment</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tidymodels/orbital/blob/v0.5.0/vignettes/articles/database-deployment.Rmd" class="external-link"><code>vignettes/articles/database-deployment.Rmd</code></a></small>
      <div class="d-none name"><code>database-deployment.Rmd</code></div>
    </div>

    
    
<p>Once you’ve created an orbital object, you can deploy it to a
database by creating a TABLE or VIEW. Both approaches use the same
underlying SQL generation, but they have different tradeoffs:</p>
<ul>
<li><p><strong>Tables</strong> store pre-computed predictions. They’re
fast to query and work well for large datasets or complex models. The
tradeoff is that predictions become stale when data changes, so you’ll
need a scheduled job to refresh them.</p></li>
<li><p><strong>Views</strong> compute predictions on-the-fly each time
they’re queried. Predictions are always fresh, but query performance
depends on model complexity and data size. Views are useful for
prototyping, smaller datasets, or when you need real-time
predictions.</p></li>
</ul>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>We start by loading our packages and creating a simple fitted
workflow.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/orbital" class="external-link">orbital</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/recipes" class="external-link">recipes</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/parsnip" class="external-link">parsnip</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/workflows" class="external-link">workflows</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dbi.r-dbi.org" class="external-link">DBI</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r.duckdb.org/" class="external-link">duckdb</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rec_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html" class="external-link">recipe</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">disp</span> <span class="op">+</span> <span class="va">wt</span> <span class="op">+</span> <span class="va">hp</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_normalize.html" class="external-link">step_normalize</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html" class="external-link">all_numeric_predictors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lm_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://parsnip.tidymodels.org/reference/linear_reg.html" class="external-link">linear_reg</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wf_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://workflows.tidymodels.org/reference/workflow.html" class="external-link">workflow</a></span><span class="op">(</span><span class="va">rec_spec</span>, <span class="va">lm_spec</span><span class="op">)</span></span>
<span><span class="va">wf_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="va">wf_spec</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span></span></code></pre></div>
<p>Then create our orbital object.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">orbital_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orbital.html">orbital</a></span><span class="op">(</span><span class="va">wf_fit</span><span class="op">)</span></span>
<span><span class="va">orbital_obj</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="connect-to-a-database">Connect to a database<a class="anchor" aria-label="anchor" href="#connect-to-a-database"></a>
</h2>
<p>We’ll use DuckDB as our example database since it runs in-memory and
requires no external setup. The same pattern works with other databases
like PostgreSQL, Snowflake, SQL Server, and Spark.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span><span class="fu"><a href="https://r.duckdb.org/reference/duckdb.html" class="external-link">duckdb</a></span><span class="op">(</span>dbdir <span class="op">=</span> <span class="st">":memory:"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mtcars_db</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/copy_to.html" class="external-link">copy_to</a></span><span class="op">(</span><span class="va">con</span>, <span class="va">mtcars</span>, name <span class="op">=</span> <span class="st">"mtcars_data"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="generating-the-prediction-sql">Generating the prediction SQL<a class="anchor" aria-label="anchor" href="#generating-the-prediction-sql"></a>
</h2>
<p>Both tables and views start the same way: use
<code><a href="../reference/orbital_inline.html">orbital_inline()</a></code> with <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">dplyr::mutate()</a></code> to apply
predictions to a database table, then extract the generated SQL.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Apply predictions to the table</span></span>
<span><span class="va">predictions</span> <span class="op">&lt;-</span> <span class="va">mtcars_db</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="op">!</span><span class="fu"><a href="../reference/orbital_inline.html">orbital_inline</a></span><span class="op">(</span><span class="va">orbital_obj</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View the lazy query</span></span>
<span><span class="va">predictions</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source:   SQL [?? x 12]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Database: DuckDB 1.4.4 [unknown@Linux 6.14.0-1017-azure:R 4.5.2/:memory:]</span></span></span>
<span><span class="co">#&gt;      mpg   cyl    disp     hp  drat       wt  qsec    vs    am  gear</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  21       6 -<span style="color: #BB0000;">0.571</span>  -<span style="color: #BB0000;">0.535</span>  3.9  -<span style="color: #BB0000;">0.610</span>    16.5     0     1     4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  21       6 -<span style="color: #BB0000;">0.571</span>  -<span style="color: #BB0000;">0.535</span>  3.9  -<span style="color: #BB0000;">0.350</span>    17.0     0     1     4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  22.8     4 -<span style="color: #BB0000;">0.990</span>  -<span style="color: #BB0000;">0.783</span>  3.85 -<span style="color: #BB0000;">0.917</span>    18.6     1     1     4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  21.4     6  0.220  -<span style="color: #BB0000;">0.535</span>  3.08 -<span style="color: #BB0000;">0.002</span><span style="color: #BB0000; text-decoration: underline;">30</span>  19.4     1     0     3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  18.7     8  1.04    0.413  3.15  0.228    17.0     0     0     3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  18.1     6 -<span style="color: #BB0000;">0.046</span><span style="color: #BB0000; text-decoration: underline;">2</span> -<span style="color: #BB0000;">0.608</span>  2.76  0.248    20.2     1     0     3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  14.3     8  1.04    1.43   3.21  0.361    15.8     0     0     3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  24.4     4 -<span style="color: #BB0000;">0.678</span>  -<span style="color: #BB0000;">1.24</span>   3.69 -<span style="color: #BB0000;">0.027</span><span style="color: #BB0000; text-decoration: underline;">8</span>   20       1     0     4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>  22.8     4 -<span style="color: #BB0000;">0.726</span>  -<span style="color: #BB0000;">0.754</span>  3.92 -<span style="color: #BB0000;">0.068</span><span style="color: #BB0000; text-decoration: underline;">7</span>   22.9     1     0     4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  19.2     6 -<span style="color: #BB0000;">0.509</span>  -<span style="color: #BB0000;">0.345</span>  3.92  0.228    18.3     1     0     4</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: carb &lt;dbl&gt;, .pred &lt;dbl&gt;</span></span></span></code></pre></div>
<p>We can extract the SQL query using
<code><a href="https://dbplyr.tidyverse.org/reference/remote_name.html" class="external-link">dbplyr::remote_query()</a></code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dbplyr.tidyverse.org/" class="external-link">dbplyr</a></span><span class="op">)</span></span>
<span><span class="va">generated_sql</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dbplyr.tidyverse.org/reference/remote_name.html" class="external-link">remote_query</a></span><span class="op">(</span><span class="va">predictions</span><span class="op">)</span></span>
<span><span class="va">generated_sql</span></span>
<span><span class="co">#&gt; &lt;SQL&gt; SELECT</span></span>
<span><span class="co">#&gt;   q01.*,</span></span>
<span><span class="co">#&gt;   ((20.090625 + (disp * -0.116131681667974)) + (wt * -3.71900968057122)) + (hp * -2.13618249713439) AS ".pred"</span></span>
<span><span class="co">#&gt; FROM (</span></span>
<span><span class="co">#&gt;   SELECT</span></span>
<span><span class="co">#&gt;     mpg,</span></span>
<span><span class="co">#&gt;     cyl,</span></span>
<span><span class="co">#&gt;     (disp - 230.721875) / 123.938693831382 AS disp,</span></span>
<span><span class="co">#&gt;     (hp - 146.6875) / 68.5628684893206 AS hp,</span></span>
<span><span class="co">#&gt;     drat,</span></span>
<span><span class="co">#&gt;     (wt - 3.21725) / 0.978457442989697 AS wt,</span></span>
<span><span class="co">#&gt;     qsec,</span></span>
<span><span class="co">#&gt;     vs,</span></span>
<span><span class="co">#&gt;     am,</span></span>
<span><span class="co">#&gt;     gear,</span></span>
<span><span class="co">#&gt;     carb</span></span>
<span><span class="co">#&gt;   FROM mtcars_data</span></span>
<span><span class="co">#&gt; ) q01</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="creating-a-table">Creating a table<a class="anchor" aria-label="anchor" href="#creating-a-table"></a>
</h2>
<p>Tables store predictions at a point in time. They’re fast to query
and work well with large datasets or complex models.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">table_name</span> <span class="op">&lt;-</span> <span class="st">"mtcars_predictions"</span></span>
<span><span class="va">table_sql</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"CREATE OR REPLACE TABLE"</span>, <span class="va">table_name</span>, <span class="st">"AS"</span>, <span class="va">generated_sql</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbExecute.html" class="external-link">dbExecute</a></span><span class="op">(</span><span class="va">con</span>, <span class="va">table_sql</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 32</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html" class="external-link">tbl</a></span><span class="op">(</span><span class="va">con</span>, <span class="va">table_name</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 32 × 12</span></span></span>
<span><span class="co">#&gt;      mpg   cyl    disp     hp  drat       wt  qsec    vs    am  gear</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  21       6 -<span style="color: #BB0000;">0.571</span>  -<span style="color: #BB0000;">0.535</span>  3.9  -<span style="color: #BB0000;">0.610</span>    16.5     0     1     4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  21       6 -<span style="color: #BB0000;">0.571</span>  -<span style="color: #BB0000;">0.535</span>  3.9  -<span style="color: #BB0000;">0.350</span>    17.0     0     1     4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  22.8     4 -<span style="color: #BB0000;">0.990</span>  -<span style="color: #BB0000;">0.783</span>  3.85 -<span style="color: #BB0000;">0.917</span>    18.6     1     1     4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  21.4     6  0.220  -<span style="color: #BB0000;">0.535</span>  3.08 -<span style="color: #BB0000;">0.002</span><span style="color: #BB0000; text-decoration: underline;">30</span>  19.4     1     0     3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  18.7     8  1.04    0.413  3.15  0.228    17.0     0     0     3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  18.1     6 -<span style="color: #BB0000;">0.046</span><span style="color: #BB0000; text-decoration: underline;">2</span> -<span style="color: #BB0000;">0.608</span>  2.76  0.248    20.2     1     0     3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  14.3     8  1.04    1.43   3.21  0.361    15.8     0     0     3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  24.4     4 -<span style="color: #BB0000;">0.678</span>  -<span style="color: #BB0000;">1.24</span>   3.69 -<span style="color: #BB0000;">0.027</span><span style="color: #BB0000; text-decoration: underline;">8</span>   20       1     0     4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>  22.8     4 -<span style="color: #BB0000;">0.726</span>  -<span style="color: #BB0000;">0.754</span>  3.92 -<span style="color: #BB0000;">0.068</span><span style="color: #BB0000; text-decoration: underline;">7</span>   22.9     1     0     4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  19.2     6 -<span style="color: #BB0000;">0.509</span>  -<span style="color: #BB0000;">0.345</span>  3.92  0.228    18.3     1     0     4</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 22 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: carb &lt;dbl&gt;, .pred &lt;dbl&gt;</span></span></span></code></pre></div>
<p>The table contains predictions computed at the time it was created.
To keep predictions fresh, you would schedule a job (e.g., daily or
hourly) to drop and recreate the table, or use an incremental update
strategy that only scores new rows.</p>
</div>
<div class="section level2">
<h2 id="creating-a-view">Creating a view<a class="anchor" aria-label="anchor" href="#creating-a-view"></a>
</h2>
<p>Views compute predictions on-the-fly, providing always-fresh results
without needing a refresh job.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">view_name</span> <span class="op">&lt;-</span> <span class="st">"mtcars_predictions_view"</span></span>
<span><span class="va">view_sql</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"CREATE OR REPLACE VIEW"</span>, <span class="va">view_name</span>, <span class="st">"AS"</span>, <span class="va">generated_sql</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbExecute.html" class="external-link">dbExecute</a></span><span class="op">(</span><span class="va">con</span>, <span class="va">view_sql</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html" class="external-link">tbl</a></span><span class="op">(</span><span class="va">con</span>, <span class="va">view_name</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 32 × 12</span></span></span>
<span><span class="co">#&gt;      mpg   cyl    disp     hp  drat       wt  qsec    vs    am  gear</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  21       6 -<span style="color: #BB0000;">0.571</span>  -<span style="color: #BB0000;">0.535</span>  3.9  -<span style="color: #BB0000;">0.610</span>    16.5     0     1     4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  21       6 -<span style="color: #BB0000;">0.571</span>  -<span style="color: #BB0000;">0.535</span>  3.9  -<span style="color: #BB0000;">0.350</span>    17.0     0     1     4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  22.8     4 -<span style="color: #BB0000;">0.990</span>  -<span style="color: #BB0000;">0.783</span>  3.85 -<span style="color: #BB0000;">0.917</span>    18.6     1     1     4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  21.4     6  0.220  -<span style="color: #BB0000;">0.535</span>  3.08 -<span style="color: #BB0000;">0.002</span><span style="color: #BB0000; text-decoration: underline;">30</span>  19.4     1     0     3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  18.7     8  1.04    0.413  3.15  0.228    17.0     0     0     3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  18.1     6 -<span style="color: #BB0000;">0.046</span><span style="color: #BB0000; text-decoration: underline;">2</span> -<span style="color: #BB0000;">0.608</span>  2.76  0.248    20.2     1     0     3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  14.3     8  1.04    1.43   3.21  0.361    15.8     0     0     3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  24.4     4 -<span style="color: #BB0000;">0.678</span>  -<span style="color: #BB0000;">1.24</span>   3.69 -<span style="color: #BB0000;">0.027</span><span style="color: #BB0000; text-decoration: underline;">8</span>   20       1     0     4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>  22.8     4 -<span style="color: #BB0000;">0.726</span>  -<span style="color: #BB0000;">0.754</span>  3.92 -<span style="color: #BB0000;">0.068</span><span style="color: #BB0000; text-decoration: underline;">7</span>   22.9     1     0     4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  19.2     6 -<span style="color: #BB0000;">0.509</span>  -<span style="color: #BB0000;">0.345</span>  3.92  0.228    18.3     1     0     4</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 22 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: carb &lt;dbl&gt;, .pred &lt;dbl&gt;</span></span></span></code></pre></div>
<p>Keep in mind that the prediction SQL runs every time the view is
queried. For complex models or large tables, this can be slow.</p>
</div>
<div class="section level2">
<h2 id="selecting-specific-columns">Selecting specific columns<a class="anchor" aria-label="anchor" href="#selecting-specific-columns"></a>
</h2>
<p>In production, you often want to include only the prediction column
and an identifier column, rather than all the intermediate
calculations.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Select only ID-like columns and the prediction</span></span>
<span><span class="va">predictions_slim</span> <span class="op">&lt;-</span> <span class="va">mtcars_db</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>row_id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span>, <span class="op">!</span><span class="op">!</span><span class="op">!</span><span class="fu"><a href="../reference/orbital_inline.html">orbital_inline</a></span><span class="op">(</span><span class="va">orbital_obj</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">row_id</span>, <span class="va">.pred</span><span class="op">)</span></span>
<span></span>
<span><span class="va">slim_sql</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dbplyr.tidyverse.org/reference/remote_name.html" class="external-link">remote_query</a></span><span class="op">(</span><span class="va">predictions_slim</span><span class="op">)</span></span>
<span></span>
<span><span class="va">table_sql</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"CREATE OR REPLACE TABLE mtcars_pred_slim AS"</span>, <span class="va">slim_sql</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbExecute.html" class="external-link">dbExecute</a></span><span class="op">(</span><span class="va">con</span>, <span class="va">table_sql</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 32</span></span>
<span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html" class="external-link">tbl</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"mtcars_pred_slim"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 32 × 2</span></span></span>
<span><span class="co">#&gt;    row_id .pred</span></span>
<span><span class="co">#&gt;     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>      1  23.6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>      2  22.6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>      3  25.3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>      4  21.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>      5  18.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>      6  20.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>      7  15.6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>      8  22.9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>      9  22.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>     10  20.0</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 22 more rows</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="database-specific-considerations">Database-specific considerations<a class="anchor" aria-label="anchor" href="#database-specific-considerations"></a>
</h2>
<p>Consider versioning your prediction tables or views (e.g.,
<code>model_v1</code>, <code>model_v2</code>) so you can compare
predictions across model versions or roll back if needed.</p>
<p>The pattern shown above works across most SQL databases, but there
are some differences to be aware of:</p>
<ul>
<li>
<strong>Column naming</strong>: Some databases (e.g., Databricks)
don’t allow column names with dots. Use
<code>orbital(wf_fit, prefix = "pred")</code> to generate columns named
<code>pred</code> instead of <code>.pred</code>.</li>
<li>
<strong>SQL Server</strong>: Uses <code>CREATE OR ALTER VIEW</code>
instead of <code>CREATE OR REPLACE VIEW</code> (requires SQL Server 2016
or later).</li>
<li>
<strong>SQLite</strong>: Uses <code>DROP VIEW IF EXISTS</code>
followed by <code>CREATE VIEW</code> since it doesn’t support
<code>CREATE OR REPLACE</code>.</li>
<li>
<strong>Function support</strong>: Complex models using functions
like <code><a href="https://rdrr.io/r/base/Log.html" class="external-link">log()</a></code>, <code><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp()</a></code>, or probability functions
may behave differently across databases. Always test your generated SQL
on your target database.</li>
<li>
<strong>Query complexity</strong>: Very large models (e.g., tree
ensembles with many trees) may generate SQL that exceeds
database-specific limits on expression depth or query length.</li>
</ul>
<p>This article covers the basics. Production deployments often involve
additional considerations like access controls, monitoring, logging, and
integration with your organization’s data infrastructure.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by Emil Hvitfeldt, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

  </div></footer>
</body>
</html>
